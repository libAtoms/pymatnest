<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tutorials &#8212; ns_doc 1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=1476913b" />
    
    <script src="_static/documentation_options.js?v=29a6c3e3"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pymatnest module" href="ns_run.html" />
    <link rel="prev" title="Getting started" href="getstart.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ns_run.html" title="pymatnest module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="getstart.html" title="Getting started"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ns_doc 1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tutorials</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="tutorials">
<h1>Tutorials<a class="headerlink" href="#tutorials" title="Link to this heading">¶</a></h1>
<section id="tutorial-1-6-lennard-jones-atoms-at-fixed-volume">
<h2>Tutorial 1: 6 Lennard-Jones atoms at fixed volume<a class="headerlink" href="#tutorial-1-6-lennard-jones-atoms-at-fixed-volume" title="Link to this heading">¶</a></h2>
<p>Let’s sample the potential energy landscape of six identical Lennard-Jones atoms,
in a cubic box of fixed volume, then calculate the heat capacity curve and see what
is the most stable structure found by nested sampling.
To calculate the potential energy and generate configurations we will use <code class="docutils literal notranslate"><span class="pre">LAMMPS</span></code>.
Guidance on package requirements and on how to install <code class="docutils literal notranslate"><span class="pre">pymatnest</span></code> with <code class="docutils literal notranslate"><span class="pre">LAMMPS</span></code>
can be found in the <a class="reference internal" href="install.html"><span class="doc">Installation and quick start guide</span></a>.</p>
<section id="create-the-input-file-ns-input-tutorial-inp">
<h3>Create the input file ns_input_tutorial.inp<a class="headerlink" href="#create-the-input-file-ns-input-tutorial-inp" title="Link to this heading">¶</a></h3>
<p>We want six atoms in our simulation cell, and for the sake of simplicity let’s call them
hydrogens. The <code class="docutils literal notranslate"><span class="pre">start_species</span></code> keyword defines this, the first integer is the atomic number,
the second integer is the number of such atoms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">start_species</span><span class="o">=</span><span class="mi">1</span> <span class="mi">6</span>
</pre></div>
</div>
<p>We also have to define the volume, and <code class="docutils literal notranslate"><span class="pre">pymatnest</span></code> will generate a cubic box by default.
Let’s have a box edge length of 15 Angstroms, thus total volume of 3375.0 Angstrom^3. We need to set the
volume per atom, so</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">max_volume_per_atom</span><span class="o">=</span><span class="mf">562.5</span>
</pre></div>
</div>
<p>Nested sampling has two essential parameters. One is the number of configurations in the sampling set,
thus how many configurations are uniformly distributed at every iteration step - this is usually called the “live set” or the “walkers”.
This number determines the resolution of the sampling.
Since six atoms is a small system, few walkers will be enough, let’s start with 120. (Note: if you run the calculation in parallel, every core
will keep track of the same number of walkers, so the total number of walkers have to be an integer multiple of the cores you will use!)
We will set n_cull to 1, so that only one configuration is culled during an iteration,
the one with the highest energy value. The total number of iterations (i.e. the nested sampling cycles) necessary to reach the ground state
structure is usually around 1000 times the number of walkers in most systems. (The total number of iterations is <code class="docutils literal notranslate"><span class="pre">n_iter_times_fraction_killed</span> <span class="pre">/</span> <span class="pre">(n_cull/n_walkers)</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_walkers</span><span class="o">=</span><span class="mi">120</span>
<span class="n">n_cull</span><span class="o">=</span><span class="mi">1</span>
<span class="n">n_iter_times_fraction_killed</span><span class="o">=</span><span class="mi">1000</span>
</pre></div>
</div>
<p>At every nested sampling iteration the culled configuration has to be replaced by a new configuration. This has to have an energy lower than the one
just culled and be randomly picked. Since the phase space volume of eligible configurations quickly becomes very small as the sampling propagates,
instead of trying to generate a configuration randomly, an existing walker configuration is picked from the current live set and cloned.
A random walk is performed on this cloned configuration, until we can be satisfied that it is independent from its parent.
The length of this walk is the other nested sampling parameter we need to set.
For small Lennard-Jones clusters using MC would be the simplest, but for larger systems and more complex potentials MD is usually more efficient,
so let’s start to use this right away. It is a relatively small system, so 200 MD steps will be a good starting point.
Keywords <code class="docutils literal notranslate"><span class="pre">n_*_steps</span></code> determine the relative probability of different kind of steps. We do not want the simulation box to change at all,
so the probability of all the cell related moves needs to be zero. <code class="docutils literal notranslate"><span class="pre">atom_traj_len</span></code> determines the length of the MD trajectory in a single step.
More on this can be found in <a class="reference internal" href="getstart.html#rwp-section-reference"><span class="std std-ref">Setting the random walk parameters</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atom_algorithm</span><span class="o">=</span><span class="n">MD</span>
<span class="n">n_model_calls_expected</span><span class="o">=</span><span class="mi">200</span>
<span class="n">n_atom_steps</span><span class="o">=</span><span class="mi">1</span>
<span class="n">atom_traj_len</span><span class="o">=</span><span class="mi">5</span>
<span class="n">n_cell_volume_steps</span><span class="o">=</span><span class="mi">0</span>
<span class="n">n_cell_shear_steps</span><span class="o">=</span><span class="mi">0</span>
<span class="n">n_cell_stretch_steps</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pymatnest</span></code> will generate several output files, so it’s a good idea to choose a prefix that will be the same for all of them. E.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">out_file_prefix</span><span class="o">=</span><span class="n">NS_MD_lammps_tutorial_120_a</span>
</pre></div>
</div>
<p>We need to set the maximum temperature for estimating the maximum kinetic energy - this is needed for the initial momenta.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">KEmax_max_T</span><span class="o">=</span><span class="mi">10000</span>
</pre></div>
</div>
<p>We want to use <code class="docutils literal notranslate"><span class="pre">LAMMPS</span></code> to calculate the potential energy, so set the <code class="docutils literal notranslate"><span class="pre">energy_calculator</span></code> accordingly and set the necessary
potential parameters, just as you would do in a <code class="docutils literal notranslate"><span class="pre">LAMMPS</span></code> input file (Since ASE uses eV as units for energy, and Angstrom as units of
distance, the parameters below means that LJ_sigma = 2.5 Angstrom and LJ_epsilon = 0.1 eV will be set, no matter how <code class="docutils literal notranslate"><span class="pre">lammpslib</span></code> converts it to match
units for <code class="docutils literal notranslate"><span class="pre">LAMMPS</span></code>).
<code class="docutils literal notranslate"><span class="pre">LAMMPS_name</span></code> is the name of the <code class="docutils literal notranslate"><span class="pre">LAMMPS</span></code> machine <em>your</em> <code class="docutils literal notranslate"><span class="pre">LAMMPS</span></code> was built with.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">energy_calculator</span><span class="o">=</span><span class="n">lammps</span>
<span class="n">LAMMPS_name</span><span class="o">=</span><span class="n">serial</span>
<span class="n">LAMMPS_init_cmds</span><span class="o">=</span><span class="n">pair_style</span> <span class="n">lj</span><span class="o">/</span><span class="n">cut</span> <span class="mf">7.50</span><span class="p">;</span> <span class="n">pair_coeff</span> <span class="o">*</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="mf">2.5</span><span class="p">;</span> <span class="n">pair_modify</span> <span class="n">shift</span> <span class="n">yes</span>
<span class="n">LAMMPS_atom_types</span><span class="o">=</span><span class="n">H</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="starting-the-run">
<h3>Starting the run<a class="headerlink" href="#starting-the-run" title="Link to this heading">¶</a></h3>
<p>Now that the input file is ready, we can start the calculation by typing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ns_run</span> <span class="o">&lt;</span> <span class="n">ns_input_tutorial</span><span class="o">.</span><span class="n">inp</span> <span class="o">&gt;</span> <span class="n">ns_tutorial</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
<p>It should take about ten minutes to finish, but you can also run it in parallel (do not use more than 10 cores for this
example as it will be very inefficient).</p>
</section>
<section id="output-files-and-post-processing">
<h3>Output files and post-processing<a class="headerlink" href="#output-files-and-post-processing" title="Link to this heading">¶</a></h3>
<p>A set of output files will be generated. The file</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NS_MD_lammps_tutorial_120_a</span><span class="o">.</span><span class="n">energies</span>
</pre></div>
</div>
<p>contains three columns, the iteration number, the energy of the culled configuration in the given iteration, and the corresponding volume.
You should be able to see that the energy was high at the beginning, then gradually decreased, and converged to a value by the end.
The third column is be unchanged as we kept the volume fixed.</p>
<p>The culled configurations are saved in the <code class="docutils literal notranslate"><span class="pre">.traj.</span></code> files. If you run the sampling in parallel, every core generates its own trajectory file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NS_MD_lammps_tutorial_120_a</span><span class="o">.</span><span class="n">traj</span><span class="mf">.0</span><span class="o">.</span><span class="n">extxyz</span>
</pre></div>
</div>
<p>At the last iteration, the current live set is saved as well. This snapshot of the run contains all of the current walkers,
useful for checking the current “state” of the sampling and restarting the run if we later decide to perform more iterations.
The filename contains the iteration number when the snapshot was saved and if you run the sampling in parallel,
every core generates its own snapshot file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NS_MD_lammps_tutorial_120_a</span><span class="o">.</span><span class="n">snapshot</span><span class="mf">.119999.0</span><span class="o">.</span><span class="n">extxyz</span>
</pre></div>
</div>
<p>Look at a configuration in the snapshot file. It should look similar to this, showing an octahedral structure, the global minimum for 6 LJ atoms:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/doc_figure_tutorial_LJ6.jpg"><img alt="_images/doc_figure_tutorial_LJ6.jpg" src="_images/doc_figure_tutorial_LJ6.jpg" style="width: 500px;" />
</a>
</figure>
<p>The simplest way to extract thermodynamic information from the run is to use the <code class="docutils literal notranslate"><span class="pre">ns_analyse</span></code> code from the <code class="docutils literal notranslate"><span class="pre">pymatnest</span></code> library.
This script uses the <code class="docutils literal notranslate"><span class="pre">.energies</span></code> file to calculate the partition function, expected value of energy, heat capacity, volume…etc.
As this is a Lennard-Jones system, we wish to work in LJ units, so we set the Boltzmann constant to be 1.0 (option -k)
To calculate thermodynamic properties at 200 temperatures starting from 0.0001 and in 0.0004 (epsilon/k_B) increments we need to use the
following command. (<code class="docutils literal notranslate"><span class="pre">./ns_analyse</span> <span class="pre">--help</span></code> prints all the possible options)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">ns_analyse</span> <span class="n">MD_lammps_tutorial_100_a</span><span class="o">.</span><span class="n">energies</span> <span class="o">-</span><span class="n">k</span> <span class="mf">1.0</span> <span class="o">-</span><span class="n">M</span> <span class="mf">0.0001</span> <span class="o">-</span><span class="n">n</span> <span class="mi">200</span> <span class="o">-</span><span class="n">D</span> <span class="mf">0.0004</span>
</pre></div>
</div>
<p>This will print the output onto the screen. The fifth column is the heat capacity, and the result should look something like the curves below. The graph shows the heat capacity curve for three independent samplings. The larger peak corresponds to
the “condensation” of the six atoms.
(You can start the sampling a few more times to have some parallel results - unless you explicitly set a seed for the random number generator
all the runs will be independent and different. Do not forget to change the <code class="docutils literal notranslate"><span class="pre">out_file_prefix</span></code> keyword, so new runs do not overwrite previous ones.)</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/doc_figure_tutorial_120_cv.jpg"><img alt="_images/doc_figure_tutorial_120_cv.jpg" src="_images/doc_figure_tutorial_120_cv.jpg" style="width: 500px;" />
</a>
</figure>
</section>
<section id="improving-convergence">
<h3>Improving convergence<a class="headerlink" href="#improving-convergence" title="Link to this heading">¶</a></h3>
<p>Though the above heat capacity curves show similar behaviour we should be able to improve convergence further.
This can be done by increasing the number of walkers (“improving the resolution of the potential energy landscape”)
and/or increasing the length of the trajectory when generating a new sample.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">n_walkers</span><span class="o">=</span><span class="mi">300</span>
<span class="n">n_model_calls_expected</span><span class="o">=</span><span class="mi">400</span>
</pre></div>
</div>
<p>If you have larger runs than in the first example it is a good idea to print snapshot files more often, to help restart if a job is e.g. killed,
and we do not necessarily need all the configurations in the trajectory file (these can become huge files otherwise).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">snapshot_interval</span><span class="o">=</span><span class="mi">2000</span> <span class="c1"># print snapshot files at every 2000 iteration</span>
<span class="n">traj_interval</span><span class="o">=</span><span class="mi">100</span> <span class="c1"># print only every 100th configurtion to the trajectory file</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Nested sampling method</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation and quick start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstart.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#tutorial-1-6-lennard-jones-atoms-at-fixed-volume">Tutorial 1: 6 Lennard-Jones atoms at fixed volume</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#create-the-input-file-ns-input-tutorial-inp">Create the input file ns_input_tutorial.inp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#starting-the-run">Starting the run</a></li>
<li class="toctree-l3"><a class="reference internal" href="#output-files-and-post-processing">Output files and post-processing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#improving-convergence">Improving convergence</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="ns_run.html"><cite>pymatnest</cite> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="ns_rng.html"><cite>ns_rng</cite> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="rngstream.html"><cite>rngstream</cite> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="lammpslib.html"><cite>lammpslib</cite> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="stacktrace.html"><cite>stacktrace</cite> module</a></li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="getstart.html"
                          title="previous chapter">Getting started</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="ns_run.html"
                          title="next chapter"><cite>pymatnest</cite> module</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/tutorial.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="ns_run.html" title="pymatnest module"
             >next</a> |</li>
        <li class="right" >
          <a href="getstart.html" title="Getting started"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">ns_doc 1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Tutorials</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2015, livia.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.2.
    </div>
  </body>
</html>